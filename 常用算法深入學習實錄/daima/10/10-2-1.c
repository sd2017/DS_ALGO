#include <stdio.h>
#include <string.h>
typedef struct bigint {
    char* num;
    char zhengfu;
    int digit;
} BIGINT, *pBIGINT;

void BigIntTrans(pBIGINT num);  //?Ö·???×ª????
void BigIntMul(pBIGINT num1, pBIGINT num2, pBIGINT result); //?Ë·?????
void BigIntAdd1(pBIGINT num1, pBIGINT num2, pBIGINT result);
void BigIntAdd(pBIGINT num1, pBIGINT num2, pBIGINT result);
void BigIntSub1(pBIGINT num1, pBIGINT num2, pBIGINT result);    //????????????
void BigIntSub(pBIGINT num1, pBIGINT num2, pBIGINT result); //?õ·¨º???
void BigIntDiv(pBIGINT num1, pBIGINT num2, pBIGINT result,
               pBIGINT residue);    //????????
void BigIntPrint(pBIGINT result);   //??????????
int BigIntEqual(pBIGINT num1, pBIGINT num2);    //Á½????Ð¡?È½?

void BigIntTrim(pBIGINT num1) //????????????È¥??Ç°????????0????Ê¹??????Î»??
{
    int i;

    for (i = num1->digit - 1; i >= 0; i--) {
        if (num1->num[i] != 0) {
            break;
        }
    }

    if (i < 0) { //??????È«??Îª0
        num1->digit = 1;  //????????Î»??Îª1
        num1->num[0] = 0;
    } else {
        num1->digit = i + 1;    //????Î»??
    }
}
void BigIntTrans(pBIGINT num1) //???Ö·???×ªÎª???Ö±?Ê¾
{
    char* temp;                  //??Ê±????
    int i, k, len;
    len = strlen(num1->num); //?Ö·û´®³¤??

    if (!(temp = (char*) malloc(sizeof(char) * len))) {  //?????Ú´?
        printf("?Ú´?????Ê§??!\n");
        exit(0);
    }

    i = 0;
    num1->zhengfu = 1;   //????Îª????

    if (num1->num[0] == '-') { //?Ð¶??Ç·?Îª????
        num1->zhengfu = -1;   //????Îª????
        i++;
    }

    k = 0;   //????Î»????????

    while (num1->num[i] != '\0') { //?Ö·???Î´????
        if (num1->num[i] >= '0' && num1->num[i] <= '9') { //Îª????0~9
            temp[k] = num1->num[i] - '0';  //??ASCII??×ª??Îª??Ó¦????
            k++;
        }

        i++;
    }

    for (i = 0; i < num1->digit; i++) {  //??????????Ôª??
        num1->num[i] = 0;
    }

    num1->digit = k; //×ª??????????Î»??

    for (i = 0, k--; k >= 0; k--, i++) { //????Ê±??????Î»???Ã±??æµ½????num??
        num1->num[i] = temp[k];
    }

    BigIntTrim(num1); //?????????Ä´?????
}
void BigIntPrint(pBIGINT result) //??????????
{
    int j;

    if (result->zhengfu == -1) { //?Ç¸???
        printf("-");    //????????
    }

    if (result->digit == 1 && result->num[0] == 0) { //????????Îª0
        printf("0");
    } else { //??Îª0
        for (j = result->digit - 1; j >= 0; j--) { //?Ó¸?Î»????Î»????
            printf("%d", result->num[j]);
        }
    }
}
int BigIntEqual(pBIGINT num1, pBIGINT num2) //?È½Ï¾???Öµ??Ð¡
{
    int i;

    if (num1->digit > num2->digit) { //num1??Î»??????num2
        return 1;
    } else if (num1->digit < num2->digit) { //num1??Î»??Ð¡??num2
        return -1;
    } else { //Á½??Î»??????
        i = num1->digit - 1;  //num1??????Î»??

        while (i >= 0) {  //?Ó¸?Î»????Î»??
            if (num1->num[i] > num2->num[i]) { //num1??Ó¦Î»????num2
                return 1;
            } else if (num1->num[i] < num2->num[i]) { //num1??Ó¦Î»Ð¡??num2
                return -1;
            } else {
                i--;    //?È½???Ò»Î»
            }
        }
    }

    return 0;    //????
}
void BigIntAdd(pBIGINT num1, pBIGINT num2, pBIGINT result)
{
    int i;
    i = BigIntEqual(num1, num2); //?È½?Á½??????Öµ??Ð¡

    if (i < 0) { //num1????ÖµÐ¡??num2
        pBIGINT temp;
        temp = num1;   //????Á½??
        num1 = num2;
        num2 = temp;
    }

    if (num1->zhengfu * num2->zhengfu < 0) { //???Å²?Í¬????Ö´????
        if (i == 0) { //Á½??????
            result->digit = 1; //????????ÎªÒ»Î»??????????Öµ0
            result->num[0] = 0;    //????ÖµÎª0
            result->zhengfu = 1;   //??????Îª????
            return;    //????
        }

        BigIntSub1(num1, num2, result);   //???????????????????????Óµ?????
    } else {
        BigIntAdd1(num1, num2, result);    //???????Óº???????Í¬??????
    }
}
void BigIntAdd1(pBIGINT num1, pBIGINT num2, pBIGINT result)
{
    int i, carry;
    carry = 0;
    result->zhengfu = num1->zhengfu; //????????

    for (i = 0; i < num1->digit; i++) {  //???????????Æµ???????????
        result->num[i] = num1->num[i];
    }

    for (i = 0; i < num2->digit; i++) {  //num2?Ðµ???Ð¡??????Î»??Ò²Ð¡Ð©
        result->num[i] = result->num[i] + num2->num[i] +
                         carry;   //????Ó¦Î»?????Í½?Î»??????
        carry = result->num[i] / 10;  //??????Î»????
        result->num[i] = result->num[i] % 10; //????Ò»Î»
    }

    if (carry) { //?????????Ð½?Î»
        result->num[i] = result->num[i] + carry;
    }

    BigIntTrim(result);  //????????
}
void BigIntSub1(pBIGINT num1, pBIGINT num2, pBIGINT result) //????????????
{
    int i, borrow;
    result->zhengfu = num1->zhengfu; //??num1????Öµ??num2?ó£¬½?????????num1??Í¬
    borrow = 0;

    for (i = 0; i < num1->digit; i++) {  //?????????????Ý¸??Æµ???????
        result->num[i] = num1->num[i];
    }

    for (i = 0; i <= num2->digit; i++) {
        result->num[i] = result->num[i] - num2->num[i] -
                         borrow;  //num1??È¥num2??????È¥??Î»?Ä½?Î»

        if (result->num[i] < 0) { //??Îª????
            result->num[i] = 10 + result->num[i];  //????Î»??Î»
            borrow = 1;    //???Ã½?Î»Öµ
        } else {
            borrow = 0;
        }
    }

    if (borrow == 1) {
        result->num[i] = result->num[i] - borrow;
    }

    BigIntTrim(result);
    /*i = num1->digit;
    while (i > 0)
    {
      if (result->num[i] == 0)
      i--;
      else
      break;
    }
    result->digit = i;   //????????Î»??*/
}
void BigIntSub(pBIGINT num1, pBIGINT num2, pBIGINT result) //?õ·¨º???
{
    num2->zhengfu = -1 * num2->zhengfu;  //???????Ä·???È¡??
    BigIntAdd(num1, num2, result);   //???Ã¼Ó·?????
}
void BigIntMul(pBIGINT num1, pBIGINT num2, pBIGINT result)
{
    char carry, temp;
    int i, j, pos;

    for (i = 0; i < num1->digit + num2->digit; i++) { //???????????Ð¼???????0
        result->num[i] = 0;
    }

    for (i = 0; i < num2->digit; i++) {  //?Ã³?????Ã¿1Î»???Ô±?????
        carry = 0;    //??????Î»

        for (j = 0; j < num1->digit; j++) { //????????Ã¿1Î»
            temp = num2->num[i] * num1->num[j] + carry;    //???Ë²????Ï½?Î»
            carry = temp / 10; //??????Î»carry
            temp = temp % 10;  //???ãµ±Ç°Î»??Öµ
            pos = i + j;
            result->num[pos] += temp;  //?????????Û¼Óµ???Ê±??????
            carry = carry + result->num[pos] / 10; //??????Î»
            result->num[pos] = result->num[pos] % 10;
        }

        if (carry > 0) {
            result->num[i + j] = carry;    //????????Î»??Î»
            result->digit = i + j + 1; //????????Î»??
        } else {
            result->digit = i + j;    //????????Î»??
        }
    }

    result->zhengfu = num1->zhengfu * num2->zhengfu; //?????Ä·???
}
void BigIntDiv(pBIGINT num1, pBIGINT num2, pBIGINT result,
               pBIGINT residue) //???????????? ??? ?È¥??Î»?Ä½?Î» ?num1??Í¬ ??
{
    BIGINT quo1, residuo1, quo2;
    int i, j, k, m;              //k???????Ì½???,m?????Ìµ?Î»??
    char t;
    result->zhengfu = num1->zhengfu * num2->zhengfu; //?ÌµÄ·???
    residue->num = (char*) malloc(sizeof(char) *
                                  num2->digit);   //???????????Ú´??Õ¼?
    residue->digit = num2->digit + 1; //?????????Ä³?Ê¼Î»??????????Í¬

    for (i = 0; i < residue->digit; i++) { //??????È«????0
        residue->num[i] = 0;
    }

    m = 0;

    for (i = num1->digit - 1; i >= 0; i--) {
        residue->digit = num2->digit + 1; //??????????????Î»???È³?????Ò»Î»

        for (j = residue->digit - 1; j > 0; j--) { //??????
            residue->num[j] = residue->num[j -
                                           1];    //?????Åµ?Î»????????????Î»(Êµ???Ç½??????Ðµ?????Î»È¥??)
        }

        residue->num[0] = num1->num[i];   //???Æ±??????Ðµ?Ò»Î»????????????Î»??
        BigIntTrim(residue);//????????
        k = 0;    //????

        while (BigIntEqual(residue, num2) >= 0) { //?È½????????????Ä´?Ð¡
            BigIntSub1(residue, num2, residue);    //????????È¥????????Öµ????????????
            k++;   //???Ì¼?1
        }

        result->num[m++] = k; //??????
    }

    result->digit = m;   //?????Ìµ?Î»??

    for (i = 0; i < m / 2; i++) { //???Ì¸?Î»??×ª(?Ú¼?????????????0?????????ÌµÄ¸?Î»)
        t = result->num[i];
        result->num[i] = result->num[m - 1 - i];
        result->num[m - 1 - i] = t;
    }

    BigIntTrim(result);  //??????
    BigIntTrim(residue); //????????
}
int main()
{
    BIGINT num1, num2, result, residue;  //????????????????????????
    int i = 0, len;
    char op;
    printf("????????????Î»??:");
    scanf("%d", &len);

    if (!(num1.num = (char*) malloc(sizeof(char) * (len + 1)))) {
        printf("?Ú´?????Ê§??!\n");
        exit(0);
    }

    num1.digit = len + 1;

    if (!(num2.num = (char*) malloc(sizeof(char) * (len + 1)))) {
        printf("?Ú´?????Ê§??!\n");
        exit(0);
    }

    num2.digit = len + 1;

    if (!(result.num = (char*) malloc(sizeof(char) * (2 * len + 1)))) {
        printf("?Ú´?????Ê§??!\n");
        exit(0);
    }

    result.digit = 2 * len + 1;

    for (i = 0; i < result.digit; i++) { //???Õ½?????
        result.num[i] = 0;
    }

    printf("Ñ¡??????????????(+??-??*??/):");
    fflush(stdin);
    scanf("%c", &op);

    switch (op) {
    case '+':
        printf("\n???ë±»????:");
        scanf("%s", num1.num);
        printf("\n????????:");
        scanf("%s", num2.num);
        BigIntTrans(&num1);
        BigIntTrans(&num2);
        BigIntAdd(&num1, &num2, &result); //?Ó·?
        break;

    case '-':
        printf("\n???ë±»????:");
        scanf("%s", num1.num);
        printf("\n????????:");
        scanf("%s", num2.num);
        BigIntTrans(&num1);
        BigIntTrans(&num2);
        BigIntSub(&num1, &num2, &result); //????
        break;

    case '*':
        printf("\n???ë±»????:");
        scanf("%s", num1.num);
        printf("\n????????:");
        scanf("%s", num2.num);
        BigIntTrans(&num1);
        BigIntTrans(&num2);
        BigIntMul(&num1, &num2, &result); //?Ë·?
        break;

    case '/':
        printf("\n???ë±»????:");
        scanf("%s", num1.num);
        printf("\n????????:");
        scanf("%s", num2.num);
        BigIntTrans(&num1);
        BigIntTrans(&num2);

        if (num2.digit == 1 && num2.num[0] == 0) { //??????Îª0
            printf("????????Îª0!\n");
        } else {
            BigIntDiv(&num1, &num2, &result, &residue);    //??????
        }

        break;
    }

    if (op == '/') {
        if (!(num2.digit == 1 && num2.num[0] == 0)) { //Îª?????Ò³?????Îª0
            printf("??:");
            BigIntPrint(&result);
            printf("\t????:");
            BigIntPrint(&residue);
        }
    } else {
        printf("\n????:");
        BigIntPrint(&result);
    }

    getch();
    return 0;
}
